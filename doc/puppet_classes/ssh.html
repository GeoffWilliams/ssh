<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: ssh
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::ssh";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (s)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">ssh</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: ssh</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/init.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>Install and manage ssh daemon with Puppet.</p>

<p>Package installation is determined automatically on RedHat or you may
supply a valid package name in <code>package_name</code>. Where additional
information is required for package installation (eg location of package
file when using rpm directly) then this can be passed using
<code>manual_package</code>. This is a requirement for AIX and Solaris.</p>

<p>This module only rewrites the parts the of the <code>sshd_config</code>
file you tell it to in order to preserve defaults/fixes from the vendor.
Where explicit configuration is required, it should be passed in the
<code>settings</code> hash.</p>

<p>Augeaus SSH provider is used to perform the re-write of the
<code>sshd_config</code> file</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Install SSH server using the defaults</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_ssh'>ssh</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Configure SSH server but don&#39;t perform any software installation</p>
</div></p>
      
      <pre class="example code"><code>class { &quot;ssh&quot;:
  manage_package =&gt; false,
}</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Install and configure SSH server but don&#39;t touch the service</p>
</div></p>
      
      <pre class="example code"><code>class { &quot;ssh&quot;:
  manage_service =&gt; false,
}</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Install and configure SSH server but disable root logins and enable debug
logging</p>
</div></p>
      
      <pre class="example code"><code>class { &quot;ssh&quot;:
  settings =&gt; {
    &quot;permit_root_login&quot; =&gt; &quot;no&quot;,
    &quot;log_level&quot;         =&gt; &quot;DEBUG&quot;,
  },
}</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Install and configure SSH server on AIX</p>
</div></p>
      
      <pre class="example code"><code>class { &quot;ssh&quot;:
  manual_package =&gt; {
    &quot;provider&quot;     =&gt; &quot;rpm&quot;,
    &quot;package_name&quot; =&gt; &quot;megacorp_ssh&quot;,
    &quot;source&quot;       =&gt; &quot;/tmp/megacorp_ssh.rpm&quot;
  },
}</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data for some common settings (supported keys are those allowed by
ssh itself)</p>
</div></p>
      
      <pre class="example code"><code>ssh::settings:
  Banner: &quot;/etc/issue.net&quot;
  Protocol: &quot;2&quot;
  MaxAuthTries: &quot;4&quot;
  PermitRootLogin: &quot;no&quot;
  Ciphers:
    - &quot;aes128-ctr&quot;
    - &quot;aes192-ctr&quot;
    - &quot;aes256-ctr&quot;
  ClientAliveInterval: &quot;300&quot;
  ClientAliveCountMax: &quot;1&quot;</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>manage_package</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p><code>true</code> to manage package installation otherwise false</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_service</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p><code>true</code> to manage the service otherwise false</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>name of the SSH service on this system</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_ensure</span>
      
      
        <span class='type'>(<tt>Enum["stopped", "running"]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;running&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>State to ensure the ssh service to</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_enable</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p><code>true</code> to enable the service on boot, <code>false</code> to
leave it alone</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manual_package</span>
      
      
        <span class='type'>(<tt>Optional[Hash]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash of additional properties for the <code>package</code> resource.
Required on AIX and Solaris</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>auto_install</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p><code>true</code> if we can install automatically without having to specify
package details manually. Normally autodetected</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>package_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Name of package to install. On Solaris and AIX, you must ensure the name
you supply here matches that described in any package file you try to
install in order to avoid idempotency errors when puppet cant detect that
the package has already been installed</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config_file_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;/etc/ssh/sshd_config&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Full path of SSHD config file to write</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config_file_group</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Group ownership for SSHD config file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config_file_mode</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Permissions for SSHD config file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_service</span>
      
      
        <span class='type'></span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>True if we should manage the SSHD service with Puppet</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_name</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Name of the SSHD service on this system</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_title</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;sshd&quot;</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>settings</span>
      
      
        <span class='type'>(<tt>Hash[String,Variant[String,Array[String]]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://forge.puppet.com/herculesteam/augeasproviders_ssh" target="_parent" title="https://forge.puppet.com/herculesteam/augeasproviders_ssh">https://forge.puppet.com/herculesteam/augeasproviders_ssh</a></li>
    
      <li><a href="https://forge.puppet.com/herculesteam/augeasproviders_core" target="_parent" title="https://forge.puppet.com/herculesteam/augeasproviders_core">https://forge.puppet.com/herculesteam/augeasproviders_core</a></li>
    
  </ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/init.pp', line 80</span>

class ssh(
    String                                      $service_name,
    Boolean                                     $auto_install,
    String                                      $package_name,
    String                                      $config_file_group,
    String                                      $config_file_mode,
    Boolean                                     $manage_package     = true,
    Boolean                                     $manage_service     = true,
    Enum[&quot;stopped&quot;, &quot;running&quot;]                  $service_ensure     = &quot;running&quot;,
    Boolean                                     $service_enable     = true,
    String                                      $config_file_name   = &quot;/etc/ssh/sshd_config&quot;,
    Optional[Hash]                              $manual_package     = undef,
    String                                      $service_title      = &quot;sshd&quot;,
    Hash[String,Variant[String,Array[String]]]  $settings           = {},
) {


  if $manage_package {
    # must specify all the details for $manual_package if used
    if ! $auto_install and empty($manual_package) {
      fail(&quot;To install SSH on ${facts[&#39;os&#39;][&#39;family&#39;]} you must pass hash of the package resources to install&quot;)
    } else {
      package { $package_name:
        * =&gt; {&quot;ensure&quot; =&gt; &quot;present&quot;} + pick($manual_package, {}),
      }
    }
  }

  file { $config_file_name:
    ensure =&gt; file,
    owner  =&gt; &quot;root&quot;,
    group  =&gt; $config_file_group,
    mode   =&gt; $config_file_mode,
  }

  # If we have been asked to manage the service then restart it if needed,
  # otherwise sysadmin needs to do this manually
  if $manage_service and $service_name {
    $notify = Service[$service_title]
  } else {
    $notify = undef
  }

  Sshd_config {
    ensure =&gt; present,
    notify =&gt; $notify,
  }

  $settings.each |$key, $value| {
    sshd_config { $key:
      value =&gt; $value
    }
  }

  # we always create Service[sshd] mananging the appropriate service to allow
  # other users of this module to refer to a consistent service name
  if $manage_service and $service_name {
    service { $service_title:
      ensure =&gt; $service_ensure,
      name   =&gt; $service_name,
      enable =&gt; $service_enable,
    }
  }

}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>